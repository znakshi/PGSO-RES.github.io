<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Make a Reservation - PGSO</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" />
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; }
        .pgso-blue { background-color: #3c5473; }
        .pgso-btn { background-color: #3c5473; }
        .pgso-btn:hover { background-color: #2c3e50; }
        
        /* Form Inputs */
        .form-input { background-color: #f3f4f6; border: none; }
        .form-input:focus { background-color: #ffffff; box-shadow: 0 0 0 2px #e5e7eb; }
        
        /* Calendar Styles */
        .cal-cell { width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; border-radius: 50%; user-select: none; }
        .cal-past { color: #d1d5db; cursor: not-allowed; pointer-events: none; } /* Grayed out & Unclickable */
        .cal-reserved { background-color: #e5e7eb; color: #9ca3af; text-decoration: line-through; cursor: not-allowed; }
        .cal-selected { background-color: #3c5473; color: white; font-weight: bold; }
        .cal-available:hover { background-color: #f3f4f6; cursor: pointer; }
    </style>
</head>
<body class="bg-gray-50 text-gray-800">

    <nav class="bg-white border-b border-gray-200 py-4 px-6 flex justify-between items-center sticky top-0 z-50">
        <div class="flex items-center gap-3">
            <a href="index.html" class="text-3xl text-slate-600 no-underline">
                <i class="fa-regular fa-building"></i>
            </a>
            <div>
                <h1 class="text-xl font-semibold tracking-tight text-gray-800">PGSO-RES</h1>
                <p class="text-xs text-gray-500 font-light">Gov. Ben Palispis Auditorium</p>
            </div>
        </div>
    </nav>

    <main class="container mx-auto px-4 py-8 max-w-5xl">
        <a href="index.html" class="inline-flex items-center text-sm font-medium text-gray-600 mb-6 hover:text-pgso-blue transition">
            <i class="fa-solid fa-arrow-left mr-2"></i> Back to Venues
        </a>

        <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-8">
            <h2 class="text-2xl font-bold mb-2">Gov. Ben Palispis Auditorium</h2>
            <p class="text-gray-500 mb-8">Fill out the form below to reserve your venue</p>

            <form id="reservation-form">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                    <div>
                        <label class="block text-sm font-bold mb-2">Full Name *</label>
                        <input type="text" class="form-input w-full rounded-md p-3" placeholder="">
                    </div>
                    <div>
                        <label class="block text-sm font-bold mb-2">Contact Number *</label>
                        <input type="text" class="form-input w-full rounded-md p-3" placeholder="">
                    </div>
                    <div class="md:col-span-2">
                        <label class="block text-sm font-bold mb-2">Email Address *</label>
                        <input type="email" class="form-input w-full rounded-md p-3" placeholder="e.g., juan@email.com">
                    </div>
                </div>

                <div class="mb-8">
                    <label class="block text-sm font-bold mb-2">Event Type</label>
                    <input type="text" class="form-input w-full rounded-md p-3" placeholder="e.g., Wedding, Conference, Birthday">
                </div>

                <h3 class="text-lg font-bold mb-2">Duration *</h3>
                <div class="space-y-3 mb-2">
                    <div class="flex items-center">
                        <input id="duration-4" name="duration" type="radio" class="w-4 h-4 text-pgso-blue bg-gray-100 border-gray-300" data-duration-value="4">
                        <label for="duration-4" class="ml-3 font-bold text-gray-800">4 hours and below (₱1,500)</label>
                    </div>
                    <div class="flex items-center">
                        <input id="duration-8" name="duration" type="radio" class="w-4 h-4 text-pgso-blue bg-gray-100 border-gray-300" data-duration-value="8">
                        <label for="duration-8" class="ml-3 font-bold text-gray-800">8 hours (₱3,000)</label>
                    </div>
                </div>
                <p class="text-s text-gray-500 mb-8">₱575 for every additional hour or a fraction thereof</p>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
                    <div>
                        <label class="block text-sm font-bold mb-2">Start Time *</label>
                        <input type="time" class="form-input w-full rounded-md p-3 text-gray-500">
                    </div>
                    <div>
                        <label class="block text-sm font-bold mb-2">End Time *</label>
                        <input type="time" class="form-input w-full rounded-md p-3 text-gray-500">
                    </div>
                </div>

                <div class="mb-8">
                     <label class="block text-sm font-bold mb-4">Select Date *</label>
                     <div class="border border-gray-100 rounded-xl p-6 max-w-md mx-auto">
                        <div class="flex justify-between items-center mb-6">
                            <button type="button" id="prevMonth" class="text-gray-800 hover:bg-gray-100 p-2 rounded-full"><i class="fa-solid fa-chevron-left"></i></button>
                            <h4 id="currentMonthYear" class="text-lg font-bold">Month Year</h4>
                            <button type="button" id="nextMonth" class="text-gray-800 hover:bg-gray-100 p-2 rounded-full"><i class="fa-solid fa-chevron-right"></i></button>
                        </div>
                        
                        <div class="grid grid-cols-7 gap-2 text-center mb-4 font-bold text-gray-800">
                            <div>Su</div><div>Mo</div><div>Tu</div><div>We</div><div>Th</div><div>Fr</div><div>Sa</div>
                        </div>
                        
                        <div id="calendar-grid" class="grid grid-cols-7 gap-2 justify-items-center text-gray-700"></div>

                        <div class="flex flex-wrap justify-center gap-4 mt-6 text-xs text-gray-600">
                            <div class="flex items-center"><div class="w-4 h-4 rounded-md bg-pgso-blue mr-2"></div> Selected</div>
                            <div class="flex items-center"><div class="w-4 h-4 rounded-md bg-gray-200 mr-2 flex justify-center items-center text-gray-400 text-[10px]"><i class="fa-solid fa-xmark"></i></div> Reserved</div>
                            <div class="flex items-center"><div class="w-4 h-4 rounded-md text-gray-300 mr-2 flex justify-center items-center text-[10px]"><i class="fa-solid fa-xmark"></i></div> Past Date</div>
                            <div class="flex items-center"><div class="w-4 h-4 rounded-md border border-gray-200 mr-2"></div> Available</div>
                        </div>
                     </div>
                </div>

                <h3 class="text-lg font-bold mb-4">Additional Services</h3>
                <div class="overflow-x-auto mb-8">
                    <table class="min-w-full text-sm text-left text-gray-500">
                        <thead class="text-xs text-gray-700 uppercase border-b">
                            <tr>
                                <th scope="col" class="p-4">Select</th>
                                <th scope="col" class="py-3">Equipment Name</th>
                                <th scope="col" class="py-3">Unit</th>
                                <th scope="col" class="py-3">Price</th>
                                <th scope="col" class="py-3 w-24">Quantity</th>
                            </tr>
                        </thead>
                        <td colspan="5" class="py-1 px-4 text-black font-medium">Use of Sound System (4 hours minimum)</td>
                        <tbody class="divide-y divide-gray-100">
                            <tr data-price="200" data-unit="hour">
                                <td class="p-4"><input type="checkbox" name="equipment" class="equipment-checkbox w-4 h-4 text-pgso-blue bg-gray-100 border-gray-300 rounded"></td>
                                <td class="py-3 font-medium text-gray-900 italic">Set 1: two (2) microphones with two (2) speakers</td>
                                <td class="py-3">per hour</td><td class="py-3 text-gray-900">₱200</td>
                                <td class="py-3"><input type="number" min="0" value="0" class="equipment-quantity form-input w-full rounded p-1 text-center" disabled></td>
                            </tr>
                            <tr data-price="400" data-unit="hour">
                                <td class="p-4"><input type="checkbox" name="equipment" class="equipment-checkbox w-4 h-4 text-pgso-blue bg-gray-100 border-gray-300 rounded"></td>
                                <td class="py-3 font-medium text-gray-900 italic">Set 2: four (4) microphones with six (6) speakers</td>
                                <td class="py-3">per hour</td><td class="py-3 text-gray-900">₱400</td>
                                <td class="py-3"><input type="number" min="0" value="0" class="equipment-quantity form-input w-full rounded p-1 text-center" disabled></td>
                            </tr>
                            <tr data-price="200" data-unit="hour">
                                <td class="p-4"><input type="checkbox" name="equipment" class="equipment-checkbox w-4 h-4 text-pgso-blue bg-gray-100 border-gray-300 rounded"></td>
                                <td class="py-3 font-medium text-gray-900">Use of Projector (4hrs minimum)</td>
                                <td class="py-3">per hour (max. 8)</td><td class="py-3 text-gray-900">₱200</td>
                                <td class="py-3"><input type="number" min="0" value="0" class="equipment-quantity form-input w-full rounded p-1 text-center" disabled></td>
                            </tr>
                            <tr data-price="10000" data-unit="day">
                                <td class="p-4"><input type="checkbox" name="equipment" class="equipment-checkbox w-4 h-4 text-pgso-blue bg-gray-100 border-gray-300 rounded"></td>
                                <td class="py-3 font-medium text-gray-900">Use of LED Wall</td>
                                <td class="py-3">per day</td><td class="py-3 text-gray-900">₱10,000</td>
                                <td class="py-3"><input type="number" min="0" value="0" class="equipment-quantity form-input w-full rounded p-1 text-center" disabled></td>
                            </tr>
                            <tr data-price="1500" data-unit="day">
                                <td class="p-4"><input type="checkbox" name="equipment" class="equipment-checkbox w-4 h-4 text-pgso-blue bg-gray-100 border-gray-300 rounded"></td>
                                <td class="py-3 font-medium text-gray-900">Use of Lighting System</td>
                                <td class="py-3">per day</td><td class="py-3 text-gray-900">₱1,500</td>
                                <td class="py-3"><input type="number" min="0" value="0" class="equipment-quantity form-input w-full rounded p-1 text-center" disabled></td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <h3 class="text-lg font-bold mb-4">Packages</h3>
                <div class="overflow-x-auto mb-8">
                    <table class="min-w-full text-sm text-left text-gray-500">
                        <thead class="text-xs text-gray-700 uppercase border-b">
                            <tr>
                                <th scope="col" class="p-4">Select</th>
                                <th scope="col" class="py-3">Equipment Name</th>
                                <th scope="col" class="py-3">Unit</th>
                                <th scope="col" class="py-3">Price</th>
                                <th scope="col" class="py-3 w-24">Quantity</th>
                            </tr>
                        </thead>
                        <tbody class="divide-y divide-gray-100">
                            <tr data-price="15500" data-unit="day">
                                <td class="p-4"><input type="checkbox" name="equipment" class="equipment-checkbox w-4 h-4 text-pgso-blue bg-gray-100 border-gray-300 rounded"></td>
                                <td class="py-3 font-medium text-gray-900">Package 1: Hall, Sound-Set 1, LED Wall, Lights</td>
                                <td class="py-3">per day</td><td class="py-3 text-gray-900">₱15,500</td>
                                <td class="py-3"><input type="number" min="0" value="0" class="equipment-quantity form-input w-full rounded p-1 text-center" disabled></td>
                            </tr>
                            <tr data-price="17500" data-unit="day">
                                <td class="p-4"><input type="checkbox" name="equipment" class="equipment-checkbox w-4 h-4 text-pgso-blue bg-gray-100 border-gray-300 rounded"></td>
                                <td class="py-3 font-medium text-gray-900">Package 2: Hall, Sound-Set 2, LED Wall, Lights</td>
                                <td class="py-3">per day</td><td class="py-3 text-gray-900">₱17,500</td>
                                <td class="py-3"><input type="number" min="0" value="0" class="equipment-quantity form-input w-full rounded p-1 text-center" disabled></td>
                            </tr>
                            <tr data-price="5000" data-unit="day">
                                <td class="p-4"><input type="checkbox" name="equipment" class="equipment-checkbox w-4 h-4 text-pgso-blue bg-gray-100 border-gray-300 rounded"></td>
                                <td class="py-3 font-medium text-gray-900">Package 3: Hall, Sound-Set 1, Projector</td>
                                <td class="py-3">per day</td><td class="py-3 text-gray-900">₱5,000</td>
                                <td class="py-3"><input type="number" min="0" value="0" class="equipment-quantity form-input w-full rounded p-1 text-center" disabled></td>
                            </tr>
                            <tr data-price="6500" data-unit="day">
                                <td class="p-4"><input type="checkbox" name="equipment" class="equipment-checkbox w-4 h-4 text-pgso-blue bg-gray-100 border-gray-300 rounded"></td>
                                <td class="py-3 font-medium text-gray-900">Package 4: Hall, Sound-Set 2, Projector</td>
                                <td class="py-3">per day</td><td class="py-3 text-gray-900">₱6,500</td>
                                <td class="py-3"><input type="number" min="0" value="0" class="equipment-quantity form-input w-full rounded p-1 text-center" disabled></td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <h3 class="text-lg font-bold mb-4">Other Equipment</h3>
                <div class="overflow-x-auto mb-8">
                    <table class="min-w-full text-sm text-left text-gray-500">
                        <thead class="text-xs text-gray-700 uppercase border-b">
                            <tr>
                                <th scope="col" class="p-4">Select</th>
                                <th scope="col" class="py-3">Equipment Name</th>
                                <th scope="col" class="py-3">Unit</th>
                                <th scope="col" class="py-3">Price</th>
                                <th scope="col" class="py-3 w-24">Quantity</th>
                            </tr>
                        </thead>
                        <tbody class="divide-y divide-gray-100">
                            <tr data-price="5500" data-unit="day"><td class="p-4"><input type="checkbox" class="equipment-checkbox w-4 h-4 rounded"></td><td class="py-3 text-gray-900">Boxing Ring Paraphernalia</td><td class="py-3">per day</td><td class="py-3">₱5,500</td><td class="py-3"><input type="number" min="0" value="0" class="equipment-quantity form-input w-full rounded p-1 text-center" disabled></td></tr>
                            <tr data-price="100" data-unit="per_day_per_chair"><td class="p-4"><input type="checkbox" class="equipment-checkbox w-4 h-4 rounded"></td><td class="py-3 text-gray-900">Folding Tables</td><td class="py-3">per table/day</td><td class="py-3">₱100</td><td class="py-3"><input type="number" min="0" value="0" class="equipment-quantity form-input w-full rounded p-1 text-center" disabled></td></tr>
                            <tr data-price="7.5" data-unit="per_day_per_chair"><td class="p-4"><input type="checkbox" class="equipment-checkbox w-4 h-4 rounded"></td><td class="py-3 text-gray-900">Monoblock Chairs</td><td class="py-3">per chair/day</td><td class="py-3">₱7.5</td><td class="py-3"><input type="number" min="0" value="0" class="equipment-quantity form-input w-full rounded p-1 text-center" disabled></td></tr>
                            <tr data-price="20" data-unit="per_day_per_chair"><td class="p-4"><input type="checkbox" class="equipment-checkbox w-4 h-4 rounded"></td><td class="py-3 text-gray-900">Monoblock Tables</td><td class="py-3">per table/day</td><td class="py-3">₱20</td><td class="py-3"><input type="number" min="0" value="0" class="equipment-quantity form-input w-full rounded p-1 text-center" disabled></td></tr>
                            <tr data-price="500" data-unit="day"><td class="p-4"><input type="checkbox" class="equipment-checkbox w-4 h-4 rounded"></td><td class="py-3 text-gray-900">Parachute Tent</td><td class="py-3">per day</td><td class="py-3">₱500</td><td class="py-3"><input type="number" min="0" value="0" class="equipment-quantity form-input w-full rounded p-1 text-center" disabled></td></tr>
                            <tr data-price="1500" data-unit="day"><td class="p-4"><input type="checkbox" class="equipment-checkbox w-4 h-4 rounded"></td><td class="py-3 text-gray-900">Red Carpet</td><td class="py-3">per day</td><td class="py-3">₱1,500</td><td class="py-3"><input type="number" min="0" value="0" class="equipment-quantity form-input w-full rounded p-1 text-center" disabled></td></tr>
                            <tr data-price="25" data-unit="hour"><td class="p-4"><input type="checkbox" class="equipment-checkbox w-4 h-4 rounded"></td><td class="py-3 text-gray-900">Microphones</td><td class="py-3">per hour</td><td class="py-3">₱25</td><td class="py-3"><input type="number" min="0" value="0" class="equipment-quantity form-input w-full rounded p-1 text-center" disabled></td></tr>
                            <tr data-price="70" data-unit="per_day_per_chair"><td class="p-4"><input type="checkbox" class="equipment-checkbox w-4 h-4 rounded"></td><td class="py-3 text-gray-900">Table Cloths</td><td class="py-3">per cloth/day</td><td class="py-3">₱70</td><td class="py-3"><input type="number" min="0" value="0" class="equipment-quantity form-input w-full rounded p-1 text-center" disabled></td></tr>
                            <tr data-price="25" data-unit="per_day_per_chair"><td class="p-4"><input type="checkbox" class="equipment-checkbox w-4 h-4 rounded"></td><td class="py-3 text-gray-900">Table Runners</td><td class="py-3">per cloth/day</td><td class="py-3">₱25</td><td class="py-3"><input type="number" min="0" value="0" class="equipment-quantity form-input w-full rounded p-1 text-center" disabled></td></tr>
                        </tbody>
                    </table>
                    <p class="text-s text-gray-500 mt-2 text-center font-light">Inclusive of four (4) tables and 250 chairs (max.)</p>
                </div>

                <div class="mb-8">
                    <label class="block text-sm font-bold mb-2">Notes / Remarks (Optional)</label>
                    <textarea class="form-input w-full rounded-md p-3 h-24 resize-none" placeholder="Any special requests or additional information..."></textarea>
                </div>

                <div class="bg-slate-100 rounded-lg p-6 mb-8">
                    <div class="flex justify-between text-sm mb-2 text-gray-700">
                        <span>Venue Base Price:</span>
                        <span id="base-price-display" class="font-medium">₱0</span>
                    </div>
                    <div class="flex justify-between text-sm mb-2 text-gray-700">
                        <span>Total Days Reserved:</span>
                        <span id="days-reserved-display" class="font-medium">0 days</span>
                    </div>
                     <div class="flex justify-between text-sm mb-2 text-gray-700">
                        <span>Total Equipment Cost:</span>
                        <span id="equipment-cost-display" class="font-medium">₱0</span>
                    </div>
                    <div class="flex justify-between text-sm mb-2 text-gray-700">
                        <span>Sub-Total (Venue x Days + Equip.):</span>
                        <span id="subtotal-display" class="font-medium">₱0</span>
                    </div>
                    <div class="flex justify-between text-sm mb-4 text-gray-700 border-b border-gray-300 pb-4">
                        <span>Security Deposit (Refundable):</span>
                        <span class="font-medium">₱3,000</span>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="text-xl font-bold text-gray-800">Estimated Total:</span>
                        <span id="estimated-total-display" class="text-3xl font-bold text-pgso-blue">₱3,000</span>
                    </div>
                    <p class="text-xs text-gray-500 mt-4">Note: Final pricing may vary based on actual hours and equipment usage. Contact PGSO for detailed quotes.</p>
                </div>

                <button type="button" class="w-full pgso-btn text-white font-bold py-4 rounded-lg text-lg transition shadow-md">
                    View Reservation Summary
                </button>

            </form>
        </div>
    </main>

    <footer class="text-center py-8 text-gray-400 text-sm">
        &copy; 2025 Provincial General Services Office. All rights reserved.
    </footer>

    <script>
    document.addEventListener('DOMContentLoaded', function() {
        // --- CONFIGURATION ---
        const OVERTIME_RATE = 575; 
        const SECURITY_DEPOSIT = 3000;
        const VENUE_NAME = "Gov. Ben Palispis Auditorium";
        
        // --- BLOCKED DATES DATABASE (Example) ---
        const BLOCKED_DATES = ["2025-11-20", "2025-12-25"];

        // --- DOM ELEMENTS ---
        const allTextInputs = document.querySelectorAll('input[type="text"]');
        const nameInput = allTextInputs[0];
        const contactInput = allTextInputs[1];
        const eventTypeInput = allTextInputs[2];
        const emailInput = document.querySelector('input[type="email"]');
        const notesInput = document.querySelector('textarea');
        
        const durationRadios = document.getElementsByName('duration');
        const startTimeInput = document.querySelectorAll('input[type="time"]')[0];
        const endTimeInput = document.querySelectorAll('input[type="time"]')[1];
        const equipmentRows = document.querySelectorAll('table tbody tr'); // Selects all rows from all tables
        const summaryBtn = document.querySelector('button.pgso-btn');

        // Calendar Elements
        const calendarGrid = document.getElementById('calendar-grid');
        const currentMonthYear = document.getElementById('currentMonthYear');
        const prevMonthBtn = document.getElementById('prevMonth');
        const nextMonthBtn = document.getElementById('nextMonth');

        // Totals
        const displayBasePrice = document.getElementById('base-price-display');
        const displayDays = document.getElementById('days-reserved-display');
        const displayEquipCost = document.getElementById('equipment-cost-display');
        const displaySubtotal = document.getElementById('subtotal-display');
        const displayTotal = document.getElementById('estimated-total-display');

        // --- STATE ---
        let currentDate = new Date();
        let today = new Date();
        let selectedDates = [];

        // --- 1. CALENDAR LOGIC ---
        function renderCalendar() {
            calendarGrid.innerHTML = "";
            const options = { month: 'long', year: 'numeric' };
            currentMonthYear.innerText = currentDate.toLocaleDateString('en-US', options);

            const year = currentDate.getFullYear();
            const month = currentDate.getMonth();
            const firstDay = new Date(year, month, 1).getDay();
            const daysInMonth = new Date(year, month + 1, 0).getDate();

            // Empty cells
            for (let i = 0; i < firstDay; i++) {
                calendarGrid.appendChild(document.createElement('div'));
            }

            // Days
            for (let i = 1; i <= daysInMonth; i++) {
                const dayCell = document.createElement('div');
                dayCell.classList.add('cal-cell');
                dayCell.innerText = i;
                
                // Date String: YYYY-MM-DD
                const cellDateStr = `${year}-${String(month + 1).padStart(2, '0')}-${String(i).padStart(2, '0')}`;
                
                // Comparisons (Time reset to midnight)
                const cellDateObj = new Date(year, month, i);
                const compareDate = new Date(cellDateObj.setHours(0,0,0,0));
                const compareToday = new Date(today.setHours(0,0,0,0));

                if (compareDate < compareToday) {
                    dayCell.classList.add('cal-past');
                } else if (BLOCKED_DATES.includes(cellDateStr)) {
                    dayCell.classList.add('cal-reserved');
                    dayCell.title = "Already Reserved";
                } else {
                    dayCell.classList.add('cal-available');
                    if (selectedDates.includes(cellDateStr)) {
                        dayCell.classList.add('cal-selected');
                    }
                    dayCell.addEventListener('click', function() {
                        if (selectedDates.includes(cellDateStr)) {
                            selectedDates = selectedDates.filter(d => d !== cellDateStr);
                            this.classList.remove('cal-selected');
                        } else {
                            selectedDates.push(cellDateStr);
                            this.classList.add('cal-selected');
                        }
                        calculateTotal();
                    });
                }
                calendarGrid.appendChild(dayCell);
            }
        }

        prevMonthBtn.addEventListener('click', () => { currentDate.setMonth(currentDate.getMonth() - 1); renderCalendar(); });
        nextMonthBtn.addEventListener('click', () => { currentDate.setMonth(currentDate.getMonth() + 1); renderCalendar(); });

        // --- 2. CALCULATIONS ---
        function calculateTotal() {
            const totalDays = selectedDates.length || 0;
            let baseDuration = 0;
            let basePrice = 0;
            let durationLabel = "";

            const radio = document.querySelector('input[name="duration"]:checked');
            if (radio) {
                baseDuration = parseInt(radio.dataset.durationValue);
                durationLabel = radio.nextElementSibling.innerText.trim();
                basePrice = baseDuration === 4 ? 1500 : 3000;
            }

            let hours = baseDuration;
            let overtime = 0;

            if (startTimeInput.value && endTimeInput.value) {
                const s = new Date(`1970-01-01T${startTimeInput.value}Z`);
                const e = new Date(`1970-01-01T${endTimeInput.value}Z`);
                let diff = (e - s) / (1000 * 60 * 60);
                if (diff < 0) diff += 24;
                if (diff > 0) hours = diff;
                if (hours > baseDuration && baseDuration > 0) {
                    overtime = Math.ceil(hours - baseDuration) * OVERTIME_RATE;
                }
            }

            const venueTotal = (basePrice + overtime) * (totalDays || 1);
            let equipTotal = 0;

            equipmentRows.forEach(row => {
                const cb = row.querySelector('.equipment-checkbox');
                const qtyInput = row.querySelector('.equipment-quantity');
                if (cb && cb.checked) {
                    const price = parseFloat(row.dataset.price);
                    const qty = parseInt(qtyInput.value) || 0;
                    const billingHours = Math.ceil(hours) > 0 ? Math.ceil(hours) : 1;
                    const days = totalDays || 1;
                    
                    if(row.dataset.unit.includes('hour')) {
                        equipTotal += price * qty * billingHours * days;
                    } else {
                        equipTotal += price * qty * days;
                    }
                }
            });

            // Display Logic
            const displayVenue = totalDays === 0 ? 0 : venueTotal;
            const displayEquip = totalDays === 0 ? 0 : equipTotal;
            const subTotal = displayVenue + displayEquip;
            const total = subTotal + SECURITY_DEPOSIT;

            displayDays.innerText = `${totalDays} day(s)`;
            displayBasePrice.innerHTML = overtime > 0 
                ? `₱${(basePrice*(totalDays||1)).toLocaleString()} <span class="text-red-500 text-xs">(+₱${(overtime*(totalDays||1)).toLocaleString()} OT)</span>` 
                : `₱${displayVenue.toLocaleString()}`;
            displayEquipCost.innerText = `₱${displayEquip.toLocaleString()}`;
            displaySubtotal.innerText = `₱${subTotal.toLocaleString()}`;
            displayTotal.innerText = `₱${total.toLocaleString()}`;

            return { venueTotal, equipTotal, total, hours, durationLabel, totalDays };
        }

        // Listeners
        durationRadios.forEach(r => r.addEventListener('change', calculateTotal));
        startTimeInput.addEventListener('change', calculateTotal);
        endTimeInput.addEventListener('change', calculateTotal);
        equipmentRows.forEach(row => {
            const cb = row.querySelector('.equipment-checkbox');
            const qty = row.querySelector('.equipment-quantity');
            if(cb && qty) {
                cb.addEventListener('change', function() { qty.disabled = !this.checked; qty.value = this.checked ? 1 : 0; calculateTotal(); });
                qty.addEventListener('input', calculateTotal);
            }
        });

        // --- 3. SAVE & REDIRECT ---
        summaryBtn.addEventListener('click', (e) => {
            e.preventDefault();
            const calc = calculateTotal();
            
            const equipList = [];
            equipmentRows.forEach(row => {
                const cb = row.querySelector('.equipment-checkbox');
                const qtyInput = row.querySelector('.equipment-quantity');
                if (cb && cb.checked) {
                    const price = parseFloat(row.dataset.price);
                    const qty = parseInt(qtyInput.value);
                    const billingHours = Math.ceil(calc.hours) || 1;
                    const days = calc.totalDays || 1;
                    const sub = row.dataset.unit.includes('hour') ? price * qty * billingHours * days : price * qty * days;
                    
                    equipList.push({
                        name: row.cells[1].innerText.trim(),
                        unit: row.cells[2].innerText.trim(),
                        qty: qty,
                        price: price,
                        subtotal: sub
                    });
                }
            });

            const data = {
                contact: { fullName: nameInput.value, contactNumber: contactInput.value, email: emailInput.value },
                event: { 
                    venue: VENUE_NAME, 
                    eventType: eventTypeInput.value, 
                    dates: selectedDates.sort().join(', '), 
                    startTime: startTimeInput.value, 
                    endTime: endTimeInput.value, 
                    durationLabel: calc.durationLabel,
                    totalHours: Math.ceil(calc.hours)
                },
                equipment: equipList,
                pricing: { venueTotal: calc.venueTotal, equipmentTotal: calc.equipTotal, securityDeposit: SECURITY_DEPOSIT, grandTotal: calc.total },
                notes: notesInput.value
            };

            localStorage.setItem('pgsoReservationData', JSON.stringify(data));
            window.location.href = 'summary.html';
        });

        // Initialize
        renderCalendar();
        calculateTotal();
    });
    </script>
</body>
</html>