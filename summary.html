<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reservation Summary - PGSO</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" />
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; }
        .pgso-blue { background-color: #3c5473; }
        .pgso-text { color: #3c5473; }
        .pgso-btn { background-color: #3c5473; }
        .pgso-btn:hover { background-color: #2c3e50; }
    </style>
</head>
<body class="bg-gray-50 text-gray-800">

    <nav class="bg-white border-b border-gray-200 py-4 px-6 flex justify-between items-center sticky top-0 z-50">
        <div class="flex items-center gap-3">
            <a href="index.html" class="text-3xl text-slate-600 no-underline">
                <i class="fa-regular fa-building"></i>
            </a>
            <div>
                <h1 class="text-xl font-semibold tracking-tight text-gray-800">PGSO-RES</h1>
                <p class="text-xs text-gray-500 font-light">Provincial General Services Offices</p>
            </div>
        </div>
    </nav>

    <main class="container mx-auto px-4 py-8 max-w-5xl">
        
        <a id="edit-reservation-link" href="#" class="inline-flex items-center text-sm font-bold text-gray-900 mb-4 hover:underline">
            <i class="fa-regular fa-pen-to-square mr-2"></i> Edit Reservation
        </a>

        <div class="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden">
            
            <div class="pgso-blue text-white p-6">
                <h2 class="text-xl font-medium">Reservation Summary</h2>
                <p class="text-slate-300 text-sm font-light">Please review your reservation details</p>
            </div>

            <div class="p-8">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-10 mb-10">
                    
                    <div>
                        <h3 class="text-pgso-text font-medium mb-4 text-lg">Contact Information</h3>
                        
                        <div class="mb-4">
                            <p class="text-xs text-gray-500 mb-1">Name:</p>
                            <p class="font-bold text-gray-900 text-lg" id="summary-name">Loading...</p>
                        </div>

                        <div class="mb-4">
                            <p class="text-xs text-gray-500 mb-1">Contact Number:</p>
                            <p class="font-bold text-gray-900 text-lg" id="summary-contact">Loading...</p>
                        </div>
                        
                        <div class="mb-4">
                             <p class="text-xs text-gray-500 mb-1">Email Address:</p>
                             <p class="font-bold text-gray-900 text-lg" id="summary-email">Loading...</p>
                        </div>
                    </div>

                    <div>
                        <h3 class="text-pgso-text font-medium mb-4 text-lg">Event Details</h3>

                        <div class="mb-4">
                            <p class="text-xs text-gray-500 mb-1">Venue:</p>
                            <p class="font-bold text-gray-900 text-lg" id="summary-venue">Loading...</p>
                        </div>

                        <div class="mb-4">
                            <p class="text-xs text-gray-500 mb-1">Event Type:</p>
                            <p class="font-bold text-gray-900 text-lg" id="summary-event-type">Loading...</p>
                        </div>

                        <div class="mb-4">
                            <p class="text-xs text-gray-500 mb-1">Date(s):</p>
                            <p class="font-bold text-gray-900 text-lg" id="summary-date">Loading...</p>
                        </div>

                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <p class="text-xs text-gray-500 mb-1">Time:</p>
                                <p class="font-bold text-gray-900" id="summary-time">Loading...</p>
                            </div>
                            <div>
                                <p class="text-xs text-gray-500 mb-1">Duration:</p>
                                <p class="font-bold text-gray-900" id="summary-duration">Loading...</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="mb-8">
                    <h3 class="text-pgso-text font-medium mb-4 text-lg">Additional Equipment</h3>
                    <div class="border border-gray-200 rounded-lg overflow-hidden">
                        <table class="w-full text-sm text-left">
                            <thead class="bg-white border-b border-gray-200">
                                <tr>
                                    <th class="px-6 py-4 font-bold text-gray-900">Equipment</th>
                                    <th class="px-6 py-4 font-bold text-gray-900 text-center">Quantity</th>
                                    <th class="px-6 py-4 font-bold text-gray-900">Unit</th>
                                    <th class="px-6 py-4 font-bold text-gray-900 text-right">Unit Price</th>
                                    <th class="px-6 py-4 font-bold text-gray-900 text-right">Subtotal</th>
                                </tr>
                            </thead>
                            <tbody class="divide-y divide-gray-100" id="equipment-summary-tbody">
                                <tr>
                                    <td colspan="5" class="px-6 py-4 text-center text-gray-500" id="no-equipment-message">No additional equipment selected.</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <div class="mb-8">
                    <h3 class="text-pgso-text font-medium mb-2 text-lg">Notes / Remarks</h3>
                    <div class="bg-gray-50 border border-gray-200 rounded p-4 text-gray-700" id="summary-notes">
                        None
                    </div>
                </div>

                <div class="bg-slate-100 rounded-lg p-8 mb-8 border border-slate-200">
                    <h4 class="text-pgso-text font-medium mb-6">Payment Breakdown</h4>
                    
                    <div class="flex justify-between text-sm mb-3 text-gray-800">
                        <span>Venue Rental (Base + Overage):</span>
                        <span class="font-bold" id="summary-base-rental">₱0</span>
                    </div>
                    <div class="flex justify-between text-sm mb-3 text-gray-800">
                        <span>Total Equipment Cost:</span>
                        <span class="font-bold" id="summary-equipment-cost">₱0</span>
                    </div>
                    <div class="flex justify-between text-sm mb-6 text-gray-800 border-b border-gray-300 pb-6">
                        <span>Security Deposit (Refundable):</span>
                        <span class="font-bold">₱3,000</span>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="text-xl font-bold text-pgso-text">Total Amount:</span>
                        <span class="text-3xl font-bold text-pgso-text" id="summary-total-amount">₱3,000</span>
                    </div>
                    <p class="text-xs text-gray-500 mt-4 font-light">Note: The security deposit of ₱3,000 will be refunded after event completion, subject to inspection and no damages.</p>
                </div>

                <div class="flex flex-col md:flex-row gap-4 justify-between">
                    <button onclick="goBack()" class="px-8 py-3 border border-gray-300 rounded-lg text-gray-700 font-bold hover:bg-gray-50 transition text-center w-full md:w-auto">
                        Go Back to Edit
                    </button>
                    <button onclick="submitReservation()" class="px-8 py-3 pgso-btn text-white rounded-lg font-bold shadow-md w-full md:w-auto">
                        Confirm & Submit Reservation
                    </button>
                </div>

            </div>
        </div>
    </main>

    <footer class="text-center py-8 text-gray-400 text-sm">
        &copy; 2025 Provincial General Services Office. All rights reserved.
    </footer>

    <div id="successModal" class="hidden fixed inset-0 bg-gray-900 bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-white rounded-lg shadow-2xl p-8 max-w-sm w-full text-center mx-4">
            <div class="w-16 h-16 bg-green-100 text-green-500 rounded-full flex items-center justify-center mx-auto mb-4 text-3xl">
                <i class="fa-solid fa-check"></i>
            </div>
            <h3 class="text-xl font-bold text-gray-900 mb-2">Reservation Sent!</h3>
            <p class="text-gray-500 text-sm mb-6">
                Your reservation request has been successfully submitted. Please wait for confirmation via email or text message from our admin.
            </p>
            <button onclick="returnHome()" class="w-full pgso-btn text-white font-bold py-2 rounded-lg hover:opacity-90 transition">
                Return to Homepage
            </button>
        </div>
    </div>

    <script>
        // Helper: Format Currency
        const formatCurrency = (amount) => '₱' + parseFloat(amount).toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
        // Helper: Check Empty
        const safeText = (text) => (text && text !== "") ? text : "N/A";

        document.addEventListener('DOMContentLoaded', function() {
            // 1. Get Data
            const data = JSON.parse(localStorage.getItem('pgsoReservationData'));

            if (!data) {
                alert("No reservation data found. Redirecting to home.");
                window.location.href = 'index.html';
                return;
            }

            // 2. Populate Contact Info
            document.getElementById('summary-name').textContent = safeText(data.contact.fullName);
            document.getElementById('summary-contact').textContent = safeText(data.contact.contactNumber);
            document.getElementById('summary-email').textContent = safeText(data.contact.email);

            // 3. Populate Event Info
            document.getElementById('summary-venue').textContent = safeText(data.event.venue);
            document.getElementById('summary-event-type').textContent = safeText(data.event.eventType);
            document.getElementById('summary-date').textContent = safeText(data.event.dates); // Note: "dates" plural based on previous script
            document.getElementById('summary-time').textContent = `${data.event.startTime} - ${data.event.endTime}`;
            document.getElementById('summary-duration').textContent = safeText(data.event.durationLabel);
            
            document.getElementById('summary-notes').textContent = safeText(data.notes);

            // 4. Dynamic "Edit/Back" Button Logic
            const editLink = document.getElementById('edit-reservation-link');
            const venueName = data.event.venue;
            
            let backUrl = "index.html"; // Default
            if (venueName.includes("Palispis")) {
                backUrl = "palispis-reservation.html";
            } else if (venueName.includes("PCL")) {
                backUrl = "pcl-reservation.html";
            } else if (venueName.includes("Gymnasium")) {
                backUrl = "gym-reservation.html"; // Assuming this is your gym filename
            }
            
            editLink.href = backUrl;
            // Also update the bottom button to use the same logic
            window.goBack = function() { window.location.href = backUrl; };


            // 5. Populate Equipment Table
            const equipTbody = document.getElementById('equipment-summary-tbody');
            if (data.equipment && data.equipment.length > 0) {
                equipTbody.innerHTML = ""; // Clear "No equipment" message
                
                data.equipment.forEach(item => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td class="px-6 py-4 text-gray-700 font-medium">${item.name}</td>
                        <td class="px-6 py-4 text-center">${item.qty}</td>
                        <td class="px-6 py-4 text-gray-500">${item.unit}</td>
                        <td class="px-6 py-4 text-right">${formatCurrency(item.price)}</td>
                        <td class="px-6 py-4 text-right font-bold text-gray-900">${formatCurrency(item.subtotal)}</td>
                    `;
                    equipTbody.appendChild(row);
                });
            } else {
                document.getElementById('no-equipment-message').classList.remove('hidden');
            }

            // 6. Populate Pricing
            // Note: The previous scripts bundled base + overage into "venueTotal"
            document.getElementById('summary-base-rental').textContent = formatCurrency(data.pricing.venueTotal);
            document.getElementById('summary-equipment-cost').textContent = formatCurrency(data.pricing.equipmentTotal);
            document.getElementById('summary-total-amount').textContent = formatCurrency(data.pricing.grandTotal);
        });

        // 7. Modal Logic
        function submitReservation() {
            // Here you would usually send the data to a backend server/email service
            // For now, we simulate success
            document.getElementById('successModal').classList.remove('hidden');
            
            // Clear storage so the form is empty next time
            localStorage.removeItem('pgsoReservationData');
        }

        function returnHome() {
            window.location.href = 'index.html';
        }
    </script>

</body>
</html>